<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>
        Megacam Image Colorizer
    </title>
  <style>
.slidecontainer {
  width: 100%;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 15px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.slider:hover {
  opacity: 1;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 15px;
  height: 17px;
  background: #4CAF50;
  cursor: pointer;
}

.slider::-moz-range-thumb {
  width: 15px;
  height: 17px;
  background: #4CAF50;
  cursor: pointer;
}
table, th, td {
  border: 1px solid black;
}

      .flex-container {
        display: flex;
        align-items: center; /* Use another value to see the result */
        width: 100%;
      }
      .flex-container > div {
        width: 25%;
}

</style>
</head>
<body>

<table style="width:100%">
  <tr>
    <th style="text-align:left;vertical-align:top;padding:0"> Step 1: Select a set of images
      <p>
	<form name="imageForm">
	<input type="radio" name="image" id="img1" value="veilsouth" />
	<label>Veil Nebula South</label>
	<input type="radio" name="image" id="img2" value="ngc7380" />
	<label>NGC 7380</label>
	<br>
	<input type="radio" name="image" id="img3" value="ic4603" />
	<label>IC 4603</label>
	<input type="radio" name="image" id="img4" value="ngc6820" />
	<label>NGC 6820</label>
	<input type="radio" name="image" id="img5" value="ngc1499" />
	<label>NGC 1499</label>
      </form>
    </th>
    <th  style="text-align:left;vertical-align:top;padding:0">
      Step 2: Select a filter (grizy) for each channel (RGB)
      <p>
	<div class="flex-container">
	  <div style="flex-basis:20%;text-align:right">
	    Red (R) =
	    <br>
	    Green (G) =
	    <br>
	    Blue (B) =
	  </div>
	  <div style="flex-basis:80%" >
	<input type="radio" name="Rfilt" id="Rg" value="g" />
	<label>g</label>
	<input type="radio" name="Rfilt" id="Rr" value="r" />
	<label>r</label>
	<input type="radio" name="Ufilt" id="Ru" value="u" />
	<label>u</label>
	<input type="radio" name="Rfilt" id="Rnone" value="none" checked/>
	<label>none</label>
      <br>
	<input type="radio" name="Gfilt" id="Gg" value="g" />
	<label>g</label>
	<input type="radio" name="Gfilt" id="Gr" value="r" />
	<label>r</label>
	<input type="radio" name="Gfilt" id="Gu" value="u" />
	<label>u</label>
	<input type="radio" name="Gfilt" id="Gnone" value="none" checked/>
	<label>none</label>
      <br>
	<input type="radio" name="Bfilt" id="Bg" value="g" />
	<label>g</label>
	<input type="radio" name="Bfilt" id="Br" value="r" />
	<label>r</label>
	<input type="radio" name="Bfilt" id="Bu" value="u" />
	<label>u</label>
	<input type="radio" name="Bfilt" id="Bnone" value="none" checked/>
	<label>none</label>
	  </div>
	  </div>
	

    </th>
  </tr>
  <tr>
    <th style="text-align:left;vertical-align:top;padding:0">
      Step 3: Adjust the amount of Red, Green, and Blue 
      <p>
	<div id="imageHolder"></div>
	<div class="flex-container">
      <div class="slidecontainer">
	<input type="range" min="1" max="100" value="50" class="slider" id="sliderR">
	<p>R Value: <span id="valR"></span></p>
      </div>
      <canvas id="CanvasRfilter" width="150" height="150" style="border:1px solid #d3d3d3;">
	Your browser does not support the HTML5 canvas tag.
      </canvas>
	</div>
		<div class="flex-container">
      <div class="slidecontainer">
	<input type="range" min="1" max="100" value="50" class="slider" id="sliderG">
	<p>G Value: <span id="valG"></span></p>
      </div>
      <canvas id="CanvasGfilter" width="150" height="150" style="border:1px solid #d3d3d3;">
	Your browser does not support the HTML5 canvas tag.
      </canvas>

		</div>
      	<div class="flex-container">
      <div class="slidecontainer">
	<input type="range" min="1" max="100" value="50" class="slider" id="sliderB">
	<p>B Value: <span id="valB"></span></p>
      </div>
            <canvas id="CanvasBfilter" width="150" height="150" style="border:1px solid #d3d3d3;">
	Your browser does not support the HTML5 canvas tag.
      </canvas>

            </div>
    </th>
    <th style="text-align:left;vertical-align:top;padding:0" >Combined Color image
      <br>
      

      <table>
	<th>
      <canvas id="CanvasBig" width="500" height="400" style="border:1px solid #d3d3d3;">
	Your browser does not support the HTML5 canvas tag.
      </canvas>

	</th>
	<th>
	  <br>
	  Zoom Controls
	  <br>
      <button type="button" name="zoomin" id="zoomin">In</button>
      <button type="button" name="zoomout" id="zoomout">Out</button>
      <br>
      Pan Controls
      <br>
      <button type="button" name="panleft" id="panleft">Left</button>
      <button type="button" name="panright" id="panright">Right</button>
<br>
      <button type="button" name="panup" id="panup">Up</button>
      <button type="button" name="pandown" id="pandown">Down</button>
      </th>
      </table>
      
    </th>
  </tr>
  </table>
<span id="DebugOutput"></span></p>
<script>
  var psimage = {
  imageName : "none",
  sliderValR : 50,
  sliderValG : 50,
  sliderValB : 50,
  filterR : "none",
  filterG : "none",
  filterB : "none",
  state   : "changed"
  };

  var zoomFactor=1;
  var dx=0;
  var dy=0;
  var zfac="01";
  var tx=0;
  var ty=0;
  var tx01="01";
  var ty00="00";
  var tx00="00";
  var ty01="01";
  var maxx=0;
  var maxy=0;
  var xtiles=1;
  var ytiles=1;
  psimage.sliderValR = document.getElementById("sliderR");
  psimage.sliderValG = document.getElementById("sliderG");
  psimage.sliderValB = document.getElementById("sliderB");
  var zoomIn= document.getElementById("zoomin");
  var zoomOut= document.getElementById("zoomout");
  var panLeft= document.getElementById("panleft");
  var panRight= document.getElementById("panright");
  var panUp= document.getElementById("panup");
  var panDown= document.getElementById("pandown");
  var outputR = document.getElementById("valR");
  var outputG = document.getElementById("valG");
  var outputB = document.getElementById("valB");
  var valRg = document.getElementById("Rg");
  var valRr = document.getElementById("Rr");
  var valRu = document.getElementById("Ru");
  var valRnone = document.getElementById("Rnone");
  var valGg = document.getElementById("Gg");
  var valGr = document.getElementById("Gr");
  var valGu = document.getElementById("Gu");
  var valGnone = document.getElementById("Gnone");
  var valBg = document.getElementById("Bg");
  var valBr = document.getElementById("Br");
  var valBu = document.getElementById("Bu");
  var valBnone = document.getElementById("Bnone");
  var im1 = document.getElementById("img1");
  var im2 = document.getElementById("img2");
  var im3 = document.getElementById("img3");
  var im4 = document.getElementById("img4");
  var im5 = document.getElementById("img5");
//  var im = document.getElementsByClassName("image");

  var ctxR = document.getElementById("CanvasRfilter").getContext("2d");
  var Rimg = new Image();
  Rimg.src="none_none_small.png";
  Rimg.onload = function() {ctxR.drawImage(Rimg,0,0,150,150);}

  var ctxG = document.getElementById("CanvasGfilter").getContext("2d");
  var Gimg = new Image();
  Gimg.src="none_none_small.png";
  Gimg.onload = function() {ctxG.drawImage(Gimg,0,0,150,150);}
  
  var ctxB = document.getElementById("CanvasBfilter").getContext("2d");
  var Bimg = new Image();
  Bimg.src="none_none_small.png";
  Bimg.onload = function() {ctxB.drawImage(Bimg,0,0,150,150);}
  
  var ctxBig = document.getElementById("CanvasBig").getContext("2d");
  var BigImg = new Image();
  var BigImgR00 = new Image();
  var BigImgG00 = new Image();
  var BigImgB00 = new Image();
  var BigImgR01 = new Image();
  var BigImgG01 = new Image();
  var BigImgB01 = new Image();
  var BigImgR10 = new Image();
  var BigImgG10 = new Image();
  var BigImgB10 = new Image();
  var BigImgR11 = new Image();
  var BigImgG11 = new Image();
  var BigImgB11 = new Image();
  
  BigImg.src="none_none_big.png";
  BigImgR00.src="none_none_big.png";
  BigImgG00.src="none_none_big.png";
  BigImgB00.src="none_none_big.png";
  
  BigImg.onload = function() {ctxBig.drawImage(BigImg,0,0,500,400);}

  // Display the default values:
  outputR.innerHTML = psimage.sliderValR.value;
  outputB.innerHTML = psimage.sliderValB.value;
  outputG.innerHTML = psimage.sliderValG.value;
  
  // Get the slider values when they are adjusted
  
  psimage.sliderValR.oninput = function() {
  outputR.innerHTML = this.value;
  psimage.state='changed';
  //  printDebugStuff();
  }

  psimage.sliderValG.oninput = function() {
  outputG.innerHTML = this.value;  psimage.state="changed";
//  printDebugStuff();
  }

  psimage.sliderValB.oninput = function() {
  outputB.innerHTML = this.value;  psimage.state="changed";
//  printDebugStuff();
  }

  zoomIn.onclick = function() {
  if (zoomFactor<4)
	{
        zoomFactor=zoomFactor+1;
		  psimage.state="changed";
		  if (zoomFactor==1) { zfac="01"; maxx=-0; maxy=0; xtiles=1; ytiles=1; }
		  if (zoomFactor==2) { zfac="02"; maxx=-500; maxy=-400; xtiles=2; ytiles=2; dx=dx*2-250; dy=dy*2-200}
		  if (zoomFactor==3) { zfac="03"; maxx=-1500; maxy= -1200; xtiles=4; ytiles=4;dx=dx*2-250 ; dy=dy*2-200}
		  if (zoomFactor==4) { zfac="04"; maxx=-3500; maxy= -2800; xtiles=8; ytiles=8;dx=dx*2-250; dy=dy*2-200}
		  tx=parseInt(-dx/500);
		  ty=parseInt(-dy/400);
		  if (tx<0) {tx=0;}
	          if (tx>xtiles-2) {tx=xtiles-2;}
		  if (ty<0) {ty=0;}
		  if (ty>ytiles-2) {ty=ytiles-2;}
			    
		  tx00=String(tx).padStart(2,'0');
		  tx01=String(tx+1).padStart(2,'0');
		  ty00=String(ty).padStart(2,'0');
		  ty01=String(ty+1).padStart(2,'0');
		  setImageNames();
		  
		    }
   }

		    
  zoomOut.onclick = function() {
		     if (zoomFactor>1) {
    zoomFactor=zoomFactor-1;
    psimage.state="changed";
    		  if (zoomFactor==1) { zfac="01"; maxx=-0; maxy=0; xtiles=1; ytiles=1;dx=0;dy=0;}
		  if (zoomFactor==2) { zfac="02"; maxx=-500;maxy=-400; xtiles=2; ytiles=2;dx=(dx+250)/2; dy=(dy+200)/2}
		  if (zoomFactor==3) { zfac="03"; maxx=-1500;maxy=-1200;xtiles=4; ytiles=4;dx=(dx+250)/2; dy=(dy+200)/2}
		  if (zoomFactor==4) { zfac="04"; maxx=-3500;maxy=-2800;xtiles=8; ytiles=8;dx=(dx+250)/2; dy=(dy+200)/2}
		  tx=parseInt(tx/2);
                  ty=parseInt(ty/2);
                  if (tx<0) {tx=0;}
                  if (tx>xtiles-2) {tx=xtiles-2;}
                  if (ty<0) {ty=0;}
                  if (ty>ytiles-2) {ty=ytiles-2;}

		  tx00=String(tx).padStart(2,'0');
		  tx01=String(tx+1).padStart(2,'0');
		  ty00=String(ty).padStart(2,'0');
		  ty01=String(ty+1).padStart(2,'0');

	if (zoomFactor==1) {dx=0;dy=0;tx=0;ty=0;tx00="00";ty00="00";tx01="01";ty01="01";}
	setImageNames();
    }
  }

    panLeft.onclick = function() {
    if (zoomFactor==2 && dx < 0) {
			      dx=dx+100;
			      psimage.state="changed";
			      
			      }
    
    if (zoomFactor>2 && dx < 0 ) {
    dx=dx+100;

    //we start with tx=0, ty=0, and dx=0, dy=0. If we pan too far right, we need to load different tiles

    if ((dx*-1)<((tx)*500) && tx>0) {
      tx=tx-1;
      tx00=String(tx).padStart(2,'0');
    tx01=String(tx+1).padStart(2,'0');
    setImageNames();
    }
    psimage.state="changed";
    }}

panRight.onclick = function() {
    //zoom factor 1 has just 1 image,
    //zoom factor 2 has just 4 (and they all load)

    if (zoomFactor==2 && dx > maxx ) {
	dx=dx-100;
	psimage.state="changed";
    }
    if (zoomFactor>2 && dx > maxx) {
	dx=dx-100;
	//if ((dx*-1)>((tx+1)*500) && tx<2^(zoomFactor-1)-2 ) {
	if ((-dx> (tx+1)*500) && tx < xtiles-2) {						    
	// the logic: for zoom=3, there are 4 tiles in the x direction, 00,01,02,03
	// if we pan right, tx has to be lest than the 02 tile, or else we go off the edge			      
				      tx=tx+1;
    tx00=String(tx).padStart(2,'0');
    tx01=String(tx+1).padStart(2,'0');
    setImageNames();
    } 
						      
    
    psimage.state="changed";
    }}

    panUp.onclick = function() {
    if (zoomFactor==2 && dy < 0) {
    dy=dy+100;
    psimage.state="changed";
						      }
    if (zoomFactor>2 && dy <0 ) {
    dy=dy+100;
    //we start with tx=0, ty=0, and dx=0, dy=0. If we pan too far right, we need to load different tiles

    if ((dy*-1)<((ty)*400) && ty>0) {
      ty=ty-1;
      ty00=String(ty).padStart(2,'0');
    ty01=String(ty+1).padStart(2,'0');
    setImageNames();
    }       
    psimage.state="changed";
						      }
						      
    }

    panDown.onclick = function() {
        if (zoomFactor==2 && dy > maxy) {
    dy=dy-100;
    psimage.state="changed";
						      }
    if (zoomFactor>2 && dy > maxy) {
	    dy=dy-100;
	if ((-dy> (ty+1)*400) && ty < ytiles-2) {						    
	// the logic: for zoom=3, there are 4 tiles in the x direction, 00,01,02,03
	// if we pan right, tx has to be lest than the 02 tile, or else we go off the edge			      
				      ty=ty+1;
    ty00=String(ty).padStart(2,'0');
    ty01=String(ty+1).padStart(2,'0');
    setImageNames();
}	    
    psimage.state="changed";
						      }
						      
    }
    
  valRg.onclick = function() {
  psimage.filterR= "g";
  psimage.filterR= this.value;   psimage.state="changed";
    setImageNames();
  }
  valRr.oninput = function() {
  psimage.filterR= "r";   psimage.state="changed";
    setImageNames();
  }
  valRu.oninput = function() {
  psimage.filterR= "u";
    setImageNames();
  }
  valRnone.oninput = function() {
  psimage.filterR= "none";
    setImageNames();

  }
    valBg.oninput = function() {
    psimage.filterB= "g";
    setImageNames();
    }
  valBr.oninput = function() {
    psimage.filterB= "r";
    setImageNames();
  }
  valBu.oninput = function() {
  psimage.filterB= "u";
  setImageNames();
    }
  valBnone.oninput = function() {
  psimage.filterB= "none";
  setImageNames();
  //  printDebugStuff();
  }
  valGg.oninput = function() {
  psimage.filterG= "g";
  setImageNames();
//  printDebugStuff();
  }
  valGr.oninput = function() {
  psimage.filterG= "r";
  setImageNames();
//  printDebugStuff();
  }
  valGu.oninput = function() {
  psimage.filterG= "u";
  setImageNames();
//  printDebugStuff();
  }
  valGnone.oninput = function() {
  psimage.filterG= "none";
  setImageNames();
//  printDebugStuff();
  }
  
  im1.addEventListener("click", function() {
  psimage.imageName= this.value;
  setImageNames();
//  printDebugStuff();
  });
  
  im2.onclick = function() {
  psimage.imageName= this.value;
  setImageNames();
//  printDebugStuff();
  }
  
  im3.onclick = function() {
  psimage.imageName= this.value;
  setImageNames();
//  printDebugStuff();
  }
    im4.onclick = function() {
  psimage.imageName= this.value;
  setImageNames();
//  printDebugStuff();
  }
    im5.onclick = function() {
  psimage.imageName= this.value;
  setImageNames();
  requestAnimationFrame(printDebugStuff);
					  }
					  
  requestAnimationFrame(printDebugStuff);
					  //  printDebugStuff();

					  function setImageNames()
					  {
					  Rimg.src=psimage.imageName+"_"+psimage.filterR+"_small.png";
					  Gimg.src=psimage.imageName+"_"+psimage.filterG+"_small.png";
					  Bimg.src=psimage.imageName+"_"+psimage.filterB+"_small.png";

    BigImgR00.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterR+"_big_zoom_"+zfac+"_"+ty00+"_"+tx00+".png";
    BigImgG00.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterG+"_big_zoom_"+zfac+"_"+ty00+"_"+tx00+".png";
    BigImgB00.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterB+"_big_zoom_"+zfac+"_"+ty00+"_"+tx00+".png";
     if (zoomFactor>1) {
	      
    BigImgR01.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterR+"_big_zoom_"+zfac+"_"+ty00+"_"+tx01+".png";
    BigImgG01.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterG+"_big_zoom_"+zfac+"_"+ty00+"_"+tx01+".png";
    BigImgB01.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterB+"_big_zoom_"+zfac+"_"+ty00+"_"+tx01+".png";

    BigImgR10.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterR+"_big_zoom_"+zfac+"_"+ty01+"_"+tx00+".png";
    BigImgG10.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterG+"_big_zoom_"+zfac+"_"+ty01+"_"+tx00+".png";
    BigImgB10.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterB+"_big_zoom_"+zfac+"_"+ty01+"_"+tx00+".png";

    BigImgR11.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterR+"_big_zoom_"+zfac+"_"+ty01+"_"+tx01+".png";
    BigImgG11.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterG+"_big_zoom_"+zfac+"_"+ty01+"_"+tx01+".png";
    BigImgB11.src=psimage.imageName+"/"+psimage.imageName+"_"+psimage.filterB+"_big_zoom_"+zfac+"_"+ty01+"_"+tx01+".png";

    }
    }

    function pad(n, width, z) { while(n.length<width) n = '' + z + n; return n;}
    
  function changeColors(data,R,G,B) {
  for (var i = 0; i < data.length; i+=4) {
		      data[i]=data[i]*(R/100);
		      data[i+1]=data[i+1]*(G/100);
		      data[i+2]=data[i+2]*(B/100);
		      }
  }

		      
  function changeColorsBig(data,dataR,dataG,dataB) {
  for (var i = 0; i < data.length; i+=4) {
		      data[i]=dataR[i];
		      data[i+1]=dataG[i+1];
		      data[i+2]=dataB[i+2];
		      }
  }
		      
		      var time;

  function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}	      
  function printDebugStuff(timestamp) {
		      //ctxBig.clearRect(0, 0, canvas.width, canvas.height);
		      // colorize the R/G/B thumbnails on the left because we can 
		      ctxR.drawImage(Rimg,0,0,150,150);
		      var RimgData=ctxR.getImageData(0,0,150,150);
		      ctxG.drawImage(Gimg,0,0,150,150);
		      var GimgData=ctxG.getImageData(0,0,150,150);
		      ctxB.drawImage(Bimg,0,0,150,150);
		      var BimgData=ctxB.getImageData(0,0,150,150);		      
		      changeColors(RimgData.data,psimage.sliderValR.value*4,0,0);
		      changeColors(GimgData.data,0,psimage.sliderValG.value*4,0);
		      changeColors(BimgData.data,0,0,psimage.sliderValB.value*4);


		      if (zoomFactor==1) {
		      //draw R image to the canvas, and then copy to memory to RbigData
		      ctxBig.drawImage(BigImgR00,dx,dy,500,400);
		      var RBigData=ctxBig.getImageData(0,0,500,400);
		      
		      //draw G image to the canvas, and then copy to memory to GbigData
		      ctxBig.drawImage(BigImgG00,dx,dy,500,400);
		      var GBigData=ctxBig.getImageData(0,0,500,400);
		      //draw B image to the canvas, and then copy to memory to BbigData
		      ctxBig.drawImage(BigImgB00,dx,dy,500,400); 
		      var BBigData=ctxBig.getImageData(0,0,500,400);

		      // make a copy of the memory to BigData (to get the correct size/shape image matrix)
		      var BigData=ctxBig.getImageData(0,0,500,400);

		      //change the colors for each channel
		      changeColors(RBigData.data,psimage.sliderValR.value*4,0,0);
		      changeColors(GBigData.data,0,psimage.sliderValG.value*4,0);
		      changeColors(BBigData.data,0,0,psimage.sliderValB.value*4);
		      //combine the channels
                      changeColorsBig(BigData.data,RBigData.data,GBigData.data,BBigData.data);
		      //display the colorized image
		      ctxBig.putImageData(BigData,0,0,0,0,500,400);      
}
		      if (zoomFactor>1) {
      // more complicated because if the zoomFactor is not 1, we have tiles.
      //draw R on the canvas first
      ctxBig.drawImage(BigImgR00, dx+tx*500,     dy+ty*400     ,500,400);
      ctxBig.drawImage(BigImgR01, dx+(tx+1)*500, dy+ty*400     ,500,400);
      ctxBig.drawImage(BigImgR10, dx+tx*500,     dy+(ty+1)*400 ,500,400);
      ctxBig.drawImage(BigImgR11, dx+(tx+1)*500, dy+(ty+1)*400 ,500,400);
      // get the image (for R)
      var RBigData=ctxBig.getImageData(0,0,500,400);

      //draw G on the canvas (overwrite everything else)
      ctxBig.drawImage(BigImgG00,dx+tx*500,      dy+ty*400,     500,400);
      ctxBig.drawImage(BigImgG01,dx+(tx+1)*500,  dy+ty*400,     500,400);
      ctxBig.drawImage(BigImgG10,dx+tx*500,      dy+(ty+1)*400, 500,400);
      ctxBig.drawImage(BigImgG11,dx+(tx+1)*500,  dy+(ty+1)*400, 500,400);
      // get the image (for G)
      var GBigData=ctxBig.getImageData(0,0,500,400);


      //draw B on the canvas (overwrite everything else)
      ctxBig.drawImage(BigImgB00,dx+tx*500,      dy+ty*400,     500,400);
      ctxBig.drawImage(BigImgB01,dx+(tx+1)*500,  dy+ty*400,     500,400);
      ctxBig.drawImage(BigImgB10,dx+tx*500,      dy+(ty+1)*400, 500,400);
      ctxBig.drawImage(BigImgB11,dx+(tx+1)*500,  dy+(ty+1)*400, 500,400);
      // get the image (for B)
      var BBigData=ctxBig.getImageData(0,0,500,400);

      // get the image (for everything so it has the same dimensions; this will be written over)
      var BigData=ctxBig.getImageData(0,0,500,400);

      // For each of the R/B/G data, get the color correct
      changeColors(RBigData.data,psimage.sliderValR.value*4,0,0);
      changeColors(GBigData.data,0,psimage.sliderValG.value*4,0);
      changeColors(BBigData.data,0,0,psimage.sliderValB.value*4);

      // combine the channels to get the colorized data
      changeColorsBig(BigData.data,RBigData.data,GBigData.data,BBigData.data);

      // put the data in the viewport
      ctxBig.putImageData(BigData,0,0,0,0,500,400);      
      
      
      }
		     

                      //GBigData=ctxBig.getImageData(0,0,500,400);
		      //RBigData=ctxBig.getImageData(0,0,500,400);
      		      //BBigData=ctxBig.getImageData(0,0,500,400);
		      //BigData=ctxBig.getImageData(0,0,500,400);

      
   		      ctxB.putImageData(BimgData,0,0);		      
		      ctxR.putImageData(RimgData,0,0);
		      ctxG.putImageData(GimgData,0,0);
		      psimage.state='redrawn';
		      sleep(20).then(() => { 
					  requestAnimationFrame(printDebugStuff);
					  });
 document.getElementById("DebugOutput").innerHTML = "<p style='color:grey;'>  R: "+ psimage.sliderValR.value + " G: " + psimage.sliderValG.value + " B:" + psimage.sliderValB.value + " R_filter: " + psimage.filterR + " G_filter: " + psimage.filterG + " B_filter: " + psimage.filterB + " Image_name: " + psimage.imageName + " RimageData.length: "+ RimgData.data.length + "<br> dx: " + dx + " dy: " + dy + " tx: " + tx+ " ty: " + ty+" tx00: "+tx00 + " tx01: "+tx01 +" ty00: "+ty00 + " ty01: "+ty01 +  " maxx: " + maxx + " maxy: "+ maxy+ " zoomFactor: " + zoomFactor + "<br>  |" + BigImgB00.src +"  |  " + BigImgB01.src +"  |<br>|" + BigImgB10.src +"  |  " + BigImgB11.src+"  | </p>";

  }
  
</script>

</body>
</html>
